# Excel价格批量更新工具

一个Python工具，用于批量更新Excel文件中的价格信息。

## 功能特点

### 核心功能
- **可视化配置编辑器**: 🎨 Web界面可视化编辑价格配置，无需手动编辑JSON
- **智能搜索**: 🔍 实时搜索产品名称，快速定位目标配置
- **灵活分页**: 📄 支持多种每页显示数量，轻松浏览大量产品
- **交互式操作**: 支持交互式选择多个Excel文件
- **正则匹配**: 通过正则表达式匹配产品名称关键字
- **价格区间**: 支持固定价格和价格区间两种配置方式
- **随机定价**: 在指定区间内自动生成符合步长要求的价格
- **多地域支持**: 支持动态添加任意地域（如HK、SG、MY、TW、JP、KR等），自动生成对应的价格列
- **错误处理**: 完善的错误提示，包括配置缺失、匹配失败等
- **批量处理**: 一次处理多个Excel文件

## 📦 部署与发布

### 快速部署（打包为可执行文件）

如果你想将工具打包为独立的可执行文件（无需Python环境），可以使用部署脚本：

```bash
# 1. 激活虚拟环境
source venv/bin/activate

# 2. 运行部署脚本（自动安装依赖、打包、创建发布包）
python deploy.py

# 3. 发布包位置
cd release/excel_price_updater_*

# 4. 运行可执行文件
./run.sh  # Mac/Linux
run.bat   # Windows
```

**部署选项：**
- `python deploy.py` - 单文件模式（默认，推荐）
- `python deploy.py --keep-temp` - 保留临时文件（调试用）
- `python deploy.py --onedir` - 目录模式

**详细文档：** 查看 [DEPLOYMENT.md](DEPLOYMENT.md)

---

## 💻 开发使用

### 安装要求

Python 3.8+

### 安装依赖

### 方式一：使用虚拟环境（推荐）

```bash
# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
# macOS/Linux:
source venv/bin/activate
# Windows:
# venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt
```

### 方式二：直接安装

```bash
pip install -r requirements.txt
```

## 🎨 可视化配置编辑器

推荐使用可视化配置编辑器来编辑价格配置，无需手动编写JSON：

```bash
# 启动配置编辑器
source venv/bin/activate
python open_config_editor.py
```

编辑器会自动：
- ✅ 打开浏览器显示图形界面
- ✅ 自动加载现有配置
- ✅ 实时保存修改
- ✅ 验证配置格式

详细使用说明请参阅 [CONFIG_EDITOR.md](CONFIG_EDITOR.md)

## 配置文件

创建 `config.json` 文件，配置产品名称关键字和对应的价格。

### 配置格式支持两种方式：

#### 1. 固定价格

```json
{
  "example_product": {
    "hk": 100,
    "sg": 50,
    "my": 80
  }
}
```

#### 2. 价格区间（随机生成）

```json
{
  "Nike Air force 1": {
    "hk": [550, 580, 10],
    "sg": [70, 85, 5],
    "my": [50, 60, 10]
  }
}
```

**价格区间配置格式**: `[最小值, 最大值, 步长]`

- 程序会在指定区间内随机生成符合步长要求的价格
- 示例：`[550, 580, 10]` 会随机生成 550, 560, 570, 580 中的一个值
- HK价格：推荐步长为10的倍数
- SG价格：推荐步长为5的倍数
- MY价格：推荐步长为10的倍数

**配置说明**:
- 每个键是产品名称关键字（将用于正则匹配）
- 值包含各地域的价格配置
- **支持混合格式**：同一产品的不同地域可以使用固定价格或区间价格
- **支持任意地域**：可以添加任意地域代码（如tw、jp、kr等），系统会自动检测
- **注意**：可以配置多个相关的关键字（如`samba`和`samba a`），更长的关键字会优先匹配
- **重要**：使用价格区间时，最小值和最大值都必须是步长的倍数

### 3. 混合配置示例

```json
{
  "Mixed Product": {
    "hk": [500, 600, 10],
    "sg": 70,
    "my": 50,
    "tw": 100,
    "jp": [800, 1000, 10]
  }
}
```

## Excel文件格式要求

Excel文件必须包含以下列：

| 列名 | 说明 |
|------|------|
| ProductNameCn | 产品中文名称（用于匹配关键字）|
| HKPrice | 香港价格 |
| SGPrice | 新加坡价格 |
| MYPrice | 马来西亚价格 |
| {Region}Price | 其他地域价格（如TWPrice, JPPrice等）|

**注意**：列名命名规则为 `{地域代码大写}Price`，如 TWPrice、JPPrice、KRPrice 等。

## 使用方法

### 1. 准备配置文件

确保 `config.json` 文件存在并包含正确的价格配置。

### 2. 运行程序

如果使用了虚拟环境，请先激活：

```bash
# macOS/Linux:
source venv/bin/activate

# 运行程序
python main.py
```

### 3. 交互式操作

1. **选择Excel文件**:
   - 输入Excel文件的完整路径
   - 支持通配符（如 `*.xlsx`）
   - 直接回车结束输入

2. **选择地域**:
   - 输入需要更新的地域代码（如：hk,sg,my）
   - 多个地域用逗号分隔

3. **处理结果**:
   - 处理完成后会生成带 `_updated` 后缀的新文件
   - 显示成功和失败的统计信息

### 示例

```
请输入Excel文件路径（直接回车结束输入）: data/products.xlsx
请输入Excel文件路径（直接回车结束输入）: 
总共选择了 1 个文件:
  1. data/products.xlsx

可用地域:
  HK   -> HKPrice
  SG   -> SGPrice
  MY   -> MYPrice

请输入需要更新的地域（多个用逗号分隔，如: hk,sg,my）:
地域代码: hk,sg,my

正在验证配置文件...
✓ 配置文件验证通过

============================================================
开始处理文件...
============================================================

正在处理: data/products.xlsx
✓ 成功更新 50 条记录
✓ 已保存到: data/products_updated.xlsx

============================================================
处理完成!
============================================================
成功: 1 个文件
失败: 0 个文件
```

## 匹配逻辑

1. 程序读取Excel中的 `ProductNameCn` 列
2. 对每个产品名称，在配置文件中查找所有关键字
3. 使用正则表达式（大小写不敏感）匹配产品名称
4. **优先匹配更具体（更长）的关键字**，例如：
   - 如果配置中有`samba`和`samba a`两个关键字
   - 产品名称为`Samba A产品型号X`会匹配到`samba a`而不是`samba`
5. 找到匹配的关键字后，使用对应的价格配置更新Excel

**示例** - 匹配优先级演示：

假设配置文件包含：
```json
{
  "samba a": { "hk": 150, "sg": 15, "my": 25 },
  "samba": { "hk": 100, "sg": 10, "my": 20 }
}
```

匹配结果：
- `Samba A产品型号X` → 匹配到 `samba a` → 价格: HK 150, SG 15, MY 25
- `Samba产品A` → 匹配到 `samba` → 价格: HK 100, SG 10, MY 20

**注意事项**:
- **匹配优先级**：更长的关键字优先匹配（优惠匹配规则）
- 如果产品名称中包含多个可能的关键字，优先使用更具体（更长）的那个
- 如果匹配失败，程序会报错并提示补充配置
- 如果配置中缺少某些地域的价格，程序会报错

## 错误处理

程序会在以下情况报错：

1. **配置文件不存在或格式错误**
   - 错误提示：配置文件不存在或格式错误

2. **Excel文件缺少必需列**
   - 错误提示：缺少必需的列（ProductNameCn或价格列）

3. **产品无法匹配到关键字**
   - 错误提示：无法匹配产品价格配置，列出未匹配的产品

4. **配置缺少某地域的价格**
   - 错误提示：产品缺少某地域的价格配置

5. **地域代码无效**
   - 错误提示：无效的地域代码

## 输出文件

程序会生成带 `_updated` 后缀的新文件，保留原文件不变。

例如：
- 输入：`products.xlsx`
- 输出：`products_updated.xlsx`

## 许可证

MIT License
