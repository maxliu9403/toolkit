<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excelä»·æ ¼é…ç½®ç¼–è¾‘å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: white;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .container {
            width: 100%;
            max-width: 100%;
            margin: 0;
            background: white;
            overflow: hidden;
            min-height: 100vh;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 0;
            }
            .container {
                min-height: 100vh;
            }
            .header {
                padding: 20px 15px;
            }
            .header h1 {
                font-size: 22px;
            }
            .toolbar {
                padding: 15px;
            }
            .btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            .content {
                padding: 15px;
            }
            .product-card {
                padding: 15px;
                margin-bottom: 15px;
            }
            .search-bar {
                padding: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 18px;
            }
            .header p {
                font-size: 12px;
            }
            .toolbar {
                padding: 10px;
            }
            .btn {
                padding: 6px 10px;
                font-size: 11px;
            }
            .content {
                padding: 10px;
            }
            .price-config {
                grid-template-columns: 1fr;
            }
        }
        
        @media (min-width: 1920px) {
            .price-config {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }
        
        @media (min-width: 2560px) {
            .price-config {
                grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
            }
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .toolbar {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .content {
            padding: 30px;
        }

        .product-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .product-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .product-name {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s;
            display: inline-block;
        }
        
        .product-name:hover {
            background: #f0f0f0;
            color: #667eea;
        }
        
        .product-name-edit {
            font-size: 20px;
            font-weight: 600;
            padding: 8px 12px;
            border: 2px solid #667eea;
            border-radius: 6px;
            outline: none;
            width: 400px;
            max-width: 60%;
        }
        
        .product-name-edit:focus {
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-icon {
            padding: 6px 12px;
            font-size: 12px;
        }

        .price-config {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .region-config {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 10px;
            min-width: 200px;
        }

        .region-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 6px;
            font-size: 16px;
        }

        .region-label::before {
            content: '';
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #667eea;
        }
        
        .region-label-wrapper {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
        }
        
        .region-delete-btn {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 14px;
            padding: 2px 6px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .region-delete-btn:hover {
            background: #dc3545;
            color: white;
        }

        .price-type-selector {
            display: flex;
            gap: 6px;
            margin-bottom: 8px;
        }

        .radio-group {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            font-size: 13px;
        }

        .radio-group input[type="radio"] {
            cursor: pointer;
            width: 14px;
            height: 14px;
        }
        
        .radio-group label {
            font-size: 13px;
            cursor: pointer;
        }

        .price-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 6px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .input-group label {
            font-size: 12px;
            color: #6c757d;
            font-weight: 500;
        }

        .input-group input {
            padding: 3px 4px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 15px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .fixed-price-input {
            padding: 3px 4px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 15px;
            width: 100%;
        }

        .fixed-price-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .add-product-form {
            background: #e7f3ff;
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .status-message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s;
        }

        .status-success {
            background: #28a745;
        }

        .status-error {
            background: #dc3545;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
            }
            to {
                transform: translateX(0);
            }
        }

        .tips {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .tips-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 8px;
        }

        .tips-content {
            font-size: 14px;
            color: #856404;
            line-height: 1.6;
        }

        .tips-content ul {
            margin-left: 20px;
            margin-top: 8px;
        }

        .search-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .search-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-results {
            font-size: 14px;
            color: #6c757d;
            margin-left: 10px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
            padding: 20px 0;
        }

        .pagination-info {
            color: #6c757d;
            font-size: 14px;
            margin: 0 10px;
        }

        .page-btn {
            padding: 8px 16px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: white;
            color: #495057;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .page-btn:hover:not(:disabled) {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .page-size-selector {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: 20px;
        }

        .page-size-selector select {
            padding: 6px 10px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }

        /* æ¨¡æ€å¯¹è¯æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            color: #6c757d;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: #f8f9fa;
            color: #333;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding-top: 15px;
            border-top: 2px solid #e9ecef;
        }

        .form-item {
            margin-bottom: 20px;
        }

        .form-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-item input[type="text"],
        .form-item input[type="number"] {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-item input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-item label {
            margin: 0;
            font-weight: 500;
            cursor: pointer;
            font-size: 14px;
        }

        .price-config-section {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .price-config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .price-config-title {
            font-weight: 600;
            font-size: 15px;
            color: #495057;
        }

        .price-type-toggle {
            display: flex;
            gap: 8px;
        }

        .price-type-toggle label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
        }

        .price-type-toggle input[type="radio"] {
            width: 16px;
            height: 16px;
        }

        .price-inputs-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .price-inputs-group .form-item {
            margin: 0;
        }

        .price-inputs-group .form-item input {
            width: 100%;
        }

        .alert {
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 13px;
            line-height: 1.5;
        }

        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš™ï¸ Excelä»·æ ¼é…ç½®ç¼–è¾‘å™¨</h1>
            <p>å¯è§†åŒ–ç¼–è¾‘ä»·æ ¼é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒå›ºå®šä»·æ ¼å’Œä»·æ ¼åŒºé—´ | âœ¨ ç‚¹å‡»äº§å“åç§°å¯ç¼–è¾‘</p>
        </div>

        <div class="toolbar">
            <button class="btn btn-primary" onclick="addNewProduct()">â• æ·»åŠ äº§å“</button>
            <button class="btn btn-primary" onclick="showAddRegionModalGlobal()" style="margin-left: 10px;">ğŸŒ æ·»åŠ åœ°åŸŸ</button>
            <button class="btn btn-danger" onclick="showRemoveRegionModal()" style="margin-left: 10px;">âŒ åˆ é™¤åœ°åŸŸ</button>
            <button class="btn btn-success" onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
            <button class="btn btn-secondary" onclick="loadConfig()">ğŸ“‚ å¯¼å…¥é…ç½®</button>
            <button class="btn btn-secondary" onclick="exportConfig()">ğŸ’¾ å¯¼å‡ºé…ç½®</button>
            <input type="file" id="fileInput" accept=".json" style="display:none" onchange="handleFileImport(event)">
            <input type="file" id="exportInput" accept=".json" style="display:none" onchange="handleFileExport(event)">
        </div>

        <div class="content">
            <div class="tips">
                <div class="tips-title">ğŸ’¡ é…ç½®è¯´æ˜</div>
                <div class="tips-content">
                    <strong>ä»·æ ¼ç±»å‹ï¼š</strong>
                    <ul>
                        <li><strong>å›ºå®šä»·æ ¼</strong>ï¼šæ‰€æœ‰äº§å“ä½¿ç”¨ç»Ÿä¸€ä»·æ ¼</li>
                        <li><strong>ä»·æ ¼åŒºé—´</strong>ï¼šåœ¨æŒ‡å®šèŒƒå›´å†…éšæœºç”Ÿæˆç¬¦åˆæ­¥é•¿è¦æ±‚çš„ä»·æ ¼</li>
                    </ul>
                    <strong>æ­¥é•¿è¦æ±‚ï¼š</strong>HKå’ŒMYæ¨èä½¿ç”¨10çš„å€æ•°ï¼ŒSGæ¨èä½¿ç”¨5çš„å€æ•°ã€‚æœ€å°å€¼å¿…é¡»æ˜¯æ­¥é•¿çš„å€æ•°ã€‚
                </div>
            </div>

            <div class="search-bar">
                <input type="text" id="searchInput" class="search-input" placeholder="ğŸ” æœç´¢äº§å“åç§°..." onkeyup="handleSearch()">
                <span class="search-results" id="searchResults"></span>
            </div>

            <div id="productsList"></div>

            <div class="pagination">
                <button class="page-btn" onclick="goToPage(currentPage - 1)" id="prevBtn">â€¹ ä¸Šä¸€é¡µ</button>
                <span class="pagination-info" id="pageInfo">ç¬¬ 1 é¡µï¼Œå…± 1 é¡µ</span>
                <button class="page-btn" onclick="goToPage(currentPage + 1)" id="nextBtn">ä¸‹ä¸€é¡µ â€º</button>
                <div class="page-size-selector">
                    <span>æ¯é¡µæ˜¾ç¤º:</span>
                    <select id="pageSizeSelect" onchange="changePageSize()">
                        <option value="5">5</option>
                        <option value="10" selected>10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>

            <div id="statusMessage"></div>
        </div>
    </div>

    <!-- æ·»åŠ äº§å“æ¨¡æ€å¯¹è¯æ¡† -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">â• æ·»åŠ æ–°äº§å“</h2>
                <button class="modal-close" onclick="closeAddProductModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-item">
                    <label for="newProductName">äº§å“åç§°ï¼š</label>
                    <input type="text" id="newProductName" placeholder="è¯·è¾“å…¥äº§å“åç§°">
                </div>
                
                <div class="form-item">
                    <label>é€‰æ‹©åœ°åŸŸï¼š</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="region_hk" value="hk" checked>
                            <label for="region_hk">HK (é¦™æ¸¯)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="region_sg" value="sg" checked>
                            <label for="region_sg">SG (æ–°åŠ å¡)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="region_my" value="my" checked>
                            <label for="region_my">MY (é©¬æ¥è¥¿äºš)</label>
                        </div>
                    </div>
                </div>

                <div id="regionsConfig"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddProductModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitNewProduct()">ç¡®è®¤æ·»åŠ </button>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ åœ°åŸŸæ¨¡æ€å¯¹è¯æ¡† -->
    <div id="addRegionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">â• æ·»åŠ åœ°åŸŸé…ç½®</h2>
                <button class="modal-close" onclick="closeAddRegionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    è¯·è¾“å…¥åœ°åŸŸåç§°ï¼ˆè‹±æ–‡ï¼Œå…¨å°å†™ï¼‰ï¼Œå°†ä¸ºæ‰€æœ‰äº§å“æ·»åŠ è¯¥åœ°åŸŸé…ç½®
                </div>
                
                <div class="form-item">
                    <label>åœ°åŸŸåç§°ï¼š</label>
                    <input type="text" id="newRegionName" placeholder="ä¾‹å¦‚ï¼šhk, sg, my, tw, jp..." style="width: 100%; padding: 8px; font-size: 14px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddRegionModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitAddRegion()">ç¡®è®¤æ·»åŠ </button>
            </div>
        </div>
    </div>

    <!-- åˆ é™¤åœ°åŸŸæ¨¡æ€å¯¹è¯æ¡† -->
    <div id="removeRegionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">âŒ åˆ é™¤åœ°åŸŸé…ç½®</h2>
                <button class="modal-close" onclick="closeRemoveRegionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    å‹¾é€‰è¦ä¿ç•™çš„åœ°åŸŸï¼Œæœªå‹¾é€‰çš„å°†è¢«åˆ é™¤
                </div>
                
                <div class="form-item">
                    <label>é€‰æ‹©è¦ä¿ç•™çš„åœ°åŸŸï¼š</label>
                    <div id="regionsToKeep" class="checkbox-group"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeRemoveRegionModal()">å–æ¶ˆ</button>
                <button class="btn btn-danger" onclick="submitRemoveRegion()">ç¡®è®¤åˆ é™¤</button>
            </div>
        </div>
    </div>

    <script>
        let config = {};
        let currentPage = 1;
        let pageSize = 10;
        let searchKeyword = '';
        let currentEditingProduct = null;

        // åˆå§‹åŒ–
        function init() {
            loadConfigFromServer();
        }

        // ä»æœåŠ¡å™¨åŠ è½½é…ç½®
        function loadConfigFromServer() {
            fetch('/api/config')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showMessage('åŠ è½½é…ç½®å¤±è´¥: ' + data.error, 'error');
                        config = {};
                    } else {
                        config = data;
                    }
                    renderProducts();
                })
                .catch(error => {
                    console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
                    showMessage('åŠ è½½é…ç½®å¤±è´¥', 'error');
                    config = {};
                });
        }

        // æ¸²æŸ“äº§å“åˆ—è¡¨
        function renderProducts() {
            const container = document.getElementById('productsList');
            container.innerHTML = '';

            // è·å–æ‰€æœ‰äº§å“å¹¶è¿‡æ»¤
            let products = Object.keys(config);
            
            // æœç´¢è¿‡æ»¤
            if (searchKeyword) {
                products = products.filter(p => p.toLowerCase().includes(searchKeyword.toLowerCase()));
            }

            // æ›´æ–°æœç´¢ç»“æœæç¤º
            const searchResults = document.getElementById('searchResults');
            if (searchKeyword) {
                searchResults.textContent = `æ‰¾åˆ° ${products.length} ä¸ªäº§å“`;
            } else {
                searchResults.textContent = '';
            }

            // ç©ºçŠ¶æ€
            if (products.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“¦</div>
                        <p>${searchKeyword ? 'æœªæ‰¾åˆ°åŒ¹é…çš„äº§å“' : 'è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•äº§å“é…ç½®'}</p>
                        <p style="margin-top: 10px; color: #999;">${searchKeyword ? 'å°è¯•å…¶ä»–æœç´¢å…³é”®è¯' : 'ç‚¹å‡»ä¸Šæ–¹"æ·»åŠ äº§å“"æŒ‰é’®å¼€å§‹é…ç½®'}</p>
                    </div>
                `;
                updatePagination(0);
                return;
            }

            // è®¡ç®—åˆ†é¡µ
            const totalPages = Math.ceil(products.length / pageSize);
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, products.length);
            const pageProducts = products.slice(startIndex, endIndex);

            // æ¸²æŸ“å½“å‰é¡µçš„äº§å“
            pageProducts.forEach((productName) => {
                container.appendChild(createProductCard(productName, config[productName], 0));
            });

            // æ›´æ–°åˆ†é¡µ
            updatePagination(products.length);
        }

        // æ›´æ–°åˆ†é¡µæ˜¾ç¤º
        function updatePagination(totalCount) {
            const totalPages = Math.ceil(totalCount / pageSize);
            
            // æ›´æ–°åˆ†é¡µä¿¡æ¯
            const pageInfo = document.getElementById('pageInfo');
            if (totalPages > 0) {
                pageInfo.textContent = `ç¬¬ ${currentPage} é¡µï¼Œå…± ${totalPages} é¡µ (å…± ${totalCount} ä¸ªäº§å“)`;
            } else {
                pageInfo.textContent = 'ç¬¬ 0 é¡µï¼Œå…± 0 é¡µ (å…± 0 ä¸ªäº§å“)';
            }

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
        }

        // è·³è½¬åˆ°æŒ‡å®šé¡µ
        function goToPage(page) {
            const totalProducts = searchKeyword ? 
                Object.keys(config).filter(p => p.toLowerCase().includes(searchKeyword.toLowerCase())).length :
                Object.keys(config).length;
            const totalPages = Math.ceil(totalProducts / pageSize);
            
            if (page < 1 || page > totalPages) {
                return;
            }
            
            currentPage = page;
            renderProducts();
        }

        // æ”¹å˜æ¯é¡µæ˜¾ç¤ºæ•°é‡
        function changePageSize() {
            pageSize = parseInt(document.getElementById('pageSizeSelect').value);
            currentPage = 1;
            renderProducts();
        }

        // å¤„ç†æœç´¢
        function handleSearch() {
            const searchInput = document.getElementById('searchInput');
            searchKeyword = searchInput.value.trim();
            currentPage = 1;
            renderProducts();
        }

        // åˆ›å»ºäº§å“å¡ç‰‡
        function createProductCard(productName, productConfig, index) {
            const card = document.createElement('div');
            card.className = 'product-card';
            
            // åŠ¨æ€è·å–æ‰€æœ‰åœ°åŸŸ
            const regions = Object.keys(productConfig);
            const regionHTML = regions.map(region => 
                createRegionConfig(productName, region, productConfig[region])
            ).join('');
            
            card.innerHTML = `
                <div class="product-header">
                    <div class="product-name" 
                         onclick="editProductName('${productName.replace(/'/g, "\\'")}', this)" 
                         title="ç‚¹å‡»ç¼–è¾‘äº§å“åç§°">
                        ${productName} <span style="font-size: 14px; color: #999;">âœï¸</span>
                    </div>
                    <button class="btn btn-danger btn-icon" onclick="removeProduct('${productName.replace(/'/g, "\\'")}')">âœ• åˆ é™¤</button>
                </div>
                <div class="price-config">
                    ${regionHTML}
                </div>
            `;
            return card;
        }

        // åˆ›å»ºåœ°åŒºé…ç½®
        function createRegionConfig(productName, region, regionConfig) {
            const isFixed = typeof regionConfig === 'number';
            const regionName = region.toUpperCase();
            const defaultRanges = {
                'hk': { min: 500, max: 600, step: 10 },
                'sg': { min: 70, max: 100, step: 5 },
                'my': { min: 50, max: 70, step: 10 },
                'tw': { min: 500, max: 600, step: 10 },
                'mo': { min: 500, max: 600, step: 10 },
                'jp': { min: 800, max: 1000, step: 10 },
                'kr': { min: 800, max: 1000, step: 10 },
                'id': { min: 50, max: 70, step: 10 },
                'th': { min: 50, max: 70, step: 10 },
                'ph': { min: 50, max: 70, step: 10 },
                'vn': { min: 50, max: 70, step: 10 }
            };
            const range = defaultRanges[region] || { min: 100, max: 200, step: 10 };

            const [min, max, step] = isFixed ? [range.min, range.max, range.step] : regionConfig;

            return `
                <div class="region-config">
                    <div class="region-label">
                        <div class="region-label-wrapper">
                            <span>${regionName}</span>
                        </div>
                    </div>
                    <div class="price-type-selector">
                        <div class="radio-group">
                            <input type="radio" id="${productName}_${region}_fixed" name="${productName}_${region}_type" ${isFixed ? 'checked' : ''} 
                                   onchange="updatePriceType('${productName}', '${region}', 'fixed')">
                            <label for="${productName}_${region}_fixed">å›ºå®šä»·æ ¼</label>
                        </div>
                        <div class="radio-group">
                            <input type="radio" id="${productName}_${region}_range" name="${productName}_${region}_type" ${!isFixed ? 'checked' : ''}
                                   onchange="updatePriceType('${productName}', '${region}', 'range')">
                            <label for="${productName}_${region}_range">ä»·æ ¼åŒºé—´</label>
                        </div>
                    </div>
                    ${isFixed ? `
                        <input type="number" class="fixed-price-input" value="${regionConfig}" 
                               onchange="updateFixedPrice('${productName}', '${region}', this.value)">
                    ` : `
                        <div class="price-input-group">
                            <div class="input-group">
                                <label>æœ€å°å€¼</label>
                                <input type="number" value="${min}" 
                                       onchange="updateRangePrice('${productName}', '${region}', 'min', this.value)">
                            </div>
                            <div class="input-group">
                                <label>æœ€å¤§å€¼</label>
                                <input type="number" value="${max}" 
                                       onchange="updateRangePrice('${productName}', '${region}', 'max', this.value)">
                            </div>
                            <div class="input-group">
                                <label>æ­¥é•¿</label>
                                <input type="number" value="${step}" 
                                       onchange="updateRangePrice('${productName}', '${region}', 'step', this.value)">
                            </div>
                        </div>
                    `}
                </div>
            `;
        }

        // æ›´æ–°ä»·æ ¼ç±»å‹
        function updatePriceType(productName, region, type) {
            if (type === 'fixed') {
                const defaults = { 
                    'hk': 100, 'sg': 50, 'my': 50, 'tw': 100, 'mo': 100,
                    'jp': 800, 'kr': 800, 'id': 50, 'th': 50, 'ph': 50, 'vn': 50
                };
                config[productName][region] = defaults[region] || 100;
            } else {
                const defaults = {
                    'hk': [100, 200, 10], 'sg': [50, 100, 5], 'my': [50, 100, 10],
                    'tw': [100, 200, 10], 'mo': [100, 200, 10],
                    'jp': [800, 1000, 10], 'kr': [800, 1000, 10],
                    'id': [50, 100, 10], 'th': [50, 100, 10], 'ph': [50, 100, 10], 'vn': [50, 100, 10]
                };
                config[productName][region] = [...(defaults[region] || [100, 200, 10])];
            }
            renderProducts();
            saveToServer();
        }

        // æ›´æ–°å›ºå®šä»·æ ¼
        function updateFixedPrice(productName, region, value) {
            config[productName][region] = parseInt(value) || 0;
            saveToServer();
        }

        // æ›´æ–°åŒºé—´ä»·æ ¼
        function updateRangePrice(productName, region, field, value) {
            const idx = field === 'min' ? 0 : field === 'max' ? 1 : 2;
            config[productName][region][idx] = parseInt(value) || 0;
            saveToServer();
        }

        // æ‰“å¼€æ·»åŠ äº§å“æ¨¡æ€æ¡†
        function addNewProduct() {
            document.getElementById('addProductModal').classList.add('show');
            document.getElementById('newProductName').value = '';
            
            // é‡ç½®åœ°åŸŸé€‰æ‹©
            const checkboxes = ['region_hk', 'region_sg', 'region_my'];
            checkboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                checkbox.checked = true;
                checkbox.onchange = renderRegionsConfig;
            });
            
            // æ¸²æŸ“åœ°åŸŸé…ç½®
            renderRegionsConfig();
        }
        
        // å…³é—­æ·»åŠ äº§å“æ¨¡æ€æ¡†
        function closeAddProductModal() {
            document.getElementById('addProductModal').classList.remove('show');
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.addEventListener('click', function(event) {
            const addProductModal = document.getElementById('addProductModal');
            const addRegionModal = document.getElementById('addRegionModal');
            const removeRegionModal = document.getElementById('removeRegionModal');
            
            if (event.target === addProductModal) {
                closeAddProductModal();
            }
            if (event.target === addRegionModal) {
                closeAddRegionModal();
            }
            if (event.target === removeRegionModal) {
                closeRemoveRegionModal();
            }
        });
        
        // æ¸²æŸ“åœ°åŸŸé…ç½®
        function renderRegionsConfig() {
            const container = document.getElementById('regionsConfig');
            container.innerHTML = '';
            
            const regions = ['hk', 'sg', 'my'];
            const defaults = {
                'hk': { min: 500, max: 600, step: 10, fixed: 500 },
                'sg': { min: 70, max: 100, step: 5, fixed: 70 },
                'my': { min: 50, max: 70, step: 10, fixed: 50 }
            };
            
            regions.forEach(region => {
                const checkbox = document.getElementById(`region_${region}`);
                if (!checkbox.checked) return;
                
                const def = defaults[region];
                const regionConfig = document.createElement('div');
                regionConfig.className = 'price-config-section';
                regionConfig.innerHTML = `
                    <div class="price-config-header">
                        <div class="price-config-title">${region.toUpperCase()}</div>
                        <div class="price-type-toggle">
                            <label>
                                <input type="radio" name="price_type_${region}" value="fixed" checked 
                                       onchange="togglePriceType('${region}')">
                                å›ºå®šä»·æ ¼
                            </label>
                            <label>
                                <input type="radio" name="price_type_${region}" value="range" 
                                       onchange="togglePriceType('${region}')">
                                ä»·æ ¼åŒºé—´
                            </label>
                        </div>
                    </div>
                    <div id="price_config_${region}">
                        <div class="form-item">
                            <input type="number" id="${region}_fixed_price" value="${def.fixed}" 
                                   placeholder="å›ºå®šä»·æ ¼">
                        </div>
                    </div>
                `;
                container.appendChild(regionConfig);
            });
        }
        
        // åˆ‡æ¢ä»·æ ¼ç±»å‹
        function togglePriceType(region) {
            const container = document.getElementById(`price_config_${region}`);
            const fixedType = document.querySelector(`input[name="price_type_${region}"][value="fixed"]`).checked;
            const defaults = {
                'hk': { min: 500, max: 600, step: 10, fixed: 500 },
                'sg': { min: 70, max: 100, step: 5, fixed: 70 },
                'my': { min: 50, max: 70, step: 10, fixed: 50 },
                'tw': { min: 500, max: 600, step: 10, fixed: 500 },
                'mo': { min: 500, max: 600, step: 10, fixed: 500 },
                'jp': { min: 800, max: 1000, step: 10, fixed: 800 },
                'kr': { min: 800, max: 1000, step: 10, fixed: 800 },
                'id': { min: 50, max: 70, step: 10, fixed: 50 },
                'th': { min: 50, max: 70, step: 10, fixed: 50 },
                'ph': { min: 50, max: 70, step: 10, fixed: 50 },
                'vn': { min: 50, max: 70, step: 10, fixed: 50 }
            };
            const def = defaults[region] || { min: 100, max: 200, step: 10, fixed: 100 };
            
            if (fixedType) {
                container.innerHTML = `
                    <div class="form-item">
                        <input type="number" id="${region}_fixed_price" value="${def.fixed}" 
                               placeholder="å›ºå®šä»·æ ¼">
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="price-inputs-group">
                        <div class="form-item">
                            <label>æœ€å°å€¼</label>
                            <input type="number" id="${region}_min" value="${def.min}">
                        </div>
                        <div class="form-item">
                            <label>æœ€å¤§å€¼</label>
                            <input type="number" id="${region}_max" value="${def.max}">
                        </div>
                        <div class="form-item">
                            <label>æ­¥é•¿</label>
                            <input type="number" id="${region}_step" value="${def.step}">
                        </div>
                    </div>
                `;
            }
        }
        
        // æäº¤æ–°äº§å“
        function submitNewProduct() {
            const productName = document.getElementById('newProductName').value.trim();
            
            if (!productName) {
                showMessage('è¯·è¾“å…¥äº§å“åç§°ï¼', 'error');
                return;
            }
            
            if (config[productName]) {
                showMessage('è¯¥äº§å“å·²å­˜åœ¨ï¼', 'error');
                return;
            }
            
            // æ£€æŸ¥è‡³å°‘é€‰æ‹©ä¸€ä¸ªåœ°åŸŸ
            const hasHK = document.getElementById('region_hk').checked;
            const hasSG = document.getElementById('region_sg').checked;
            const hasMY = document.getElementById('region_my').checked;
            
            if (!hasHK && !hasSG && !hasMY) {
                showMessage('è‡³å°‘éœ€è¦é€‰æ‹©ä¸€ä¸ªåœ°åŸŸï¼', 'error');
                return;
            }
            
            // æ„å»ºé…ç½®
            const newConfig = {};
            
            if (hasHK) {
                const fixedType = document.querySelector('input[name="price_type_hk"][value="fixed"]').checked;
                if (fixedType) {
                    newConfig.hk = parseInt(document.getElementById('hk_fixed_price').value) || 500;
                } else {
                    const min = parseInt(document.getElementById('hk_min').value) || 500;
                    const max = parseInt(document.getElementById('hk_max').value) || 600;
                    const step = parseInt(document.getElementById('hk_step').value) || 10;
                    newConfig.hk = [min, max, step];
                }
            }
            
            if (hasSG) {
                const fixedType = document.querySelector('input[name="price_type_sg"][value="fixed"]').checked;
                if (fixedType) {
                    newConfig.sg = parseInt(document.getElementById('sg_fixed_price').value) || 70;
                } else {
                    const min = parseInt(document.getElementById('sg_min').value) || 70;
                    const max = parseInt(document.getElementById('sg_max').value) || 100;
                    const step = parseInt(document.getElementById('sg_step').value) || 5;
                    newConfig.sg = [min, max, step];
                }
            }
            
            if (hasMY) {
                const fixedType = document.querySelector('input[name="price_type_my"][value="fixed"]').checked;
                if (fixedType) {
                    newConfig.my = parseInt(document.getElementById('my_fixed_price').value) || 50;
                } else {
                    const min = parseInt(document.getElementById('my_min').value) || 50;
                    const max = parseInt(document.getElementById('my_max').value) || 70;
                    const step = parseInt(document.getElementById('my_step').value) || 10;
                    newConfig.my = [min, max, step];
                }
            }
            
            // æ·»åŠ åˆ°é…ç½®
            config[productName] = newConfig;
            
            // æ¸²æŸ“å¹¶ä¿å­˜
            renderProducts();
            saveToServer();
            closeAddProductModal();
            showMessage('äº§å“æ·»åŠ æˆåŠŸï¼', 'success');
        }

        // åˆ é™¤äº§å“
        // ç¼–è¾‘äº§å“åç§°
        function editProductName(oldName, element) {
            // åˆ›å»ºè¾“å…¥æ¡†
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'product-name-edit';
            input.value = oldName;
            
            // æ›¿æ¢æ˜¾ç¤ºå…ƒç´ 
            element.replaceWith(input);
            input.focus();
            input.select();
            
            // ä¿å­˜å‡½æ•°
            const saveEdit = () => {
                const newName = input.value.trim();
                
                // éªŒè¯æ–°åç§°
                if (!newName) {
                    showMessage('äº§å“åç§°ä¸èƒ½ä¸ºç©ºï¼', 'error');
                    input.focus();
                    return;
                }
                
                if (newName === oldName) {
                    // åç§°æœªæ”¹å˜ï¼Œæ¢å¤æ˜¾ç¤º
                    const nameDiv = document.createElement('div');
                    nameDiv.className = 'product-name';
                    nameDiv.onclick = function() { editProductName(oldName, this); };
                    nameDiv.title = 'ç‚¹å‡»ç¼–è¾‘äº§å“åç§°';
                    nameDiv.textContent = oldName;
                    input.replaceWith(nameDiv);
                    return;
                }
                
                // æ£€æŸ¥æ–°åç§°æ˜¯å¦å·²å­˜åœ¨
                if (config[newName]) {
                    showMessage(`äº§å“åç§° "${newName}" å·²å­˜åœ¨ï¼`, 'error');
                    input.focus();
                    return;
                }
                
                // æ›´æ–°é…ç½®
                config[newName] = config[oldName];
                delete config[oldName];
                
                // é‡æ–°æ¸²æŸ“
                renderProducts();
                saveToServer();
                showMessage(`äº§å“åç§°å·²ä» "${oldName}" æ›´æ–°ä¸º "${newName}"ï¼`, 'success');
            };
            
            // å–æ¶ˆç¼–è¾‘
            const cancelEdit = () => {
                const nameDiv = document.createElement('div');
                nameDiv.className = 'product-name';
                nameDiv.onclick = function() { editProductName(oldName, this); };
                nameDiv.title = 'ç‚¹å‡»ç¼–è¾‘äº§å“åç§°';
                nameDiv.textContent = oldName;
                input.replaceWith(nameDiv);
            };
            
            // å›è½¦ä¿å­˜
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveEdit();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    cancelEdit();
                }
            });
            
            // å¤±å»ç„¦ç‚¹æ—¶ä¿å­˜
            input.addEventListener('blur', () => {
                setTimeout(saveEdit, 100);
            });
        }
        
        function removeProduct(productName) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤äº§å“ "${productName}" å—ï¼Ÿ`)) {
                delete config[productName];
                renderProducts();
                saveToServer();
                showMessage('äº§å“åˆ é™¤æˆåŠŸï¼', 'success');
            }
        }
        
        // æ˜¾ç¤ºåˆ é™¤åœ°åŸŸæ¨¡æ€æ¡†
        function showRemoveRegionModal() {
            const allRegions = new Set();
            
            // è·å–æ‰€æœ‰äº§å“å·²æœ‰çš„åœ°åŸŸ
            Object.values(config).forEach(productConfig => {
                Object.keys(productConfig).forEach(region => {
                    allRegions.add(region);
                });
            });
            
            if (allRegions.size === 0) {
                showMessage('æ²¡æœ‰å¯åˆ é™¤çš„åœ°åŸŸï¼', 'error');
                return;
            }
            
            // æ¸²æŸ“åœ°åŸŸå¤é€‰æ¡†
            const container = document.getElementById('regionsToKeep');
            container.innerHTML = '';
            
            Array.from(allRegions).sort().forEach(region => {
                const checkboxItem = document.createElement('div');
                checkboxItem.className = 'checkbox-item';
                checkboxItem.innerHTML = `
                    <input type="checkbox" id="keep_region_${region}" value="${region}" checked>
                    <label for="keep_region_${region}">${region.toUpperCase()}</label>
                `;
                container.appendChild(checkboxItem);
            });
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('removeRegionModal').classList.add('show');
        }
        
        // å…³é—­åˆ é™¤åœ°åŸŸæ¨¡æ€æ¡†
        function closeRemoveRegionModal() {
            document.getElementById('removeRegionModal').classList.remove('show');
        }
        
        // æäº¤åˆ é™¤åœ°åŸŸ
        function submitRemoveRegion() {
            const allRegions = new Set();
            Object.values(config).forEach(productConfig => {
                Object.keys(productConfig).forEach(region => {
                    allRegions.add(region);
                });
            });
            
            // è·å–è¦ä¿ç•™çš„åœ°åŸŸ
            const regionsToKeep = new Set();
            Array.from(allRegions).forEach(region => {
                const checkbox = document.getElementById(`keep_region_${region}`);
                if (checkbox && checkbox.checked) {
                    regionsToKeep.add(region);
                }
            });
            
            // æ‰¾å‡ºè¦åˆ é™¤çš„åœ°åŸŸ
            const regionsToDelete = Array.from(allRegions).filter(region => !regionsToKeep.has(region));
            
            if (regionsToDelete.length === 0) {
                showMessage('æ²¡æœ‰è¦åˆ é™¤çš„åœ°åŸŸï¼', 'error');
                return;
            }
            
            // ç¡®è®¤åˆ é™¤
            const deleteList = regionsToDelete.map(r => r.toUpperCase()).join('ã€');
            if (confirm(`ç¡®å®šè¦åˆ é™¤ä»¥ä¸‹åœ°åŸŸå—ï¼Ÿ\n\n${deleteList}\n\nè¿™å°†åˆ é™¤æ‰€æœ‰äº§å“çš„è¯¥åœ°åŸŸé…ç½®ã€‚`)) {
                let totalDeleted = 0;
                regionsToDelete.forEach(region => {
                    Object.keys(config).forEach(productName => {
                        if (config[productName][region]) {
                            delete config[productName][region];
                            totalDeleted++;
                        }
                    });
                });
                
                renderProducts();
                saveToServer();
                showMessage(`æˆåŠŸåˆ é™¤ ${totalDeleted} ä¸ªåœ°åŸŸé…ç½®ï¼`, 'success');
                closeRemoveRegionModal();
            }
        }
        
        // æ‰“å¼€å…¨å±€æ·»åŠ åœ°åŸŸæ¨¡æ€æ¡†
        function showAddRegionModalGlobal() {
            document.getElementById('addRegionModal').classList.add('show');
            document.getElementById('newRegionName').value = '';
        }
        
        // å…³é—­æ·»åŠ åœ°åŸŸæ¨¡æ€æ¡†
        function closeAddRegionModal() {
            document.getElementById('addRegionModal').classList.remove('show');
        }
        
        // æäº¤æ·»åŠ åœ°åŸŸï¼ˆåº”ç”¨åˆ°æ‰€æœ‰äº§å“ï¼‰
        function submitAddRegion() {
            const regionName = document.getElementById('newRegionName').value.trim().toLowerCase();
            
            if (!regionName) {
                showMessage('è¯·è¾“å…¥åœ°åŸŸåç§°ï¼', 'error');
                return;
            }
            
            // éªŒè¯åœ°åŸŸåç§°ï¼ˆåªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼‰
            if (!/^[a-z0-9_]+$/.test(regionName)) {
                showMessage('åœ°åŸŸåç§°åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼', 'error');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰äº§å“
            const productCount = Object.keys(config).length;
            if (productCount === 0) {
                showMessage('è¯·å…ˆæ·»åŠ äº§å“ï¼', 'error');
                closeAddRegionModal();
                return;
            }
            
            // æ£€æŸ¥åœ°åŸŸæ˜¯å¦å·²å­˜åœ¨
            const allRegions = new Set();
            Object.values(config).forEach(productConfig => {
                Object.keys(productConfig).forEach(region => {
                    allRegions.add(region);
                });
            });
            
            if (allRegions.has(regionName)) {
                showMessage(`åœ°åŸŸ "${regionName}" å·²å­˜åœ¨ï¼`, 'error');
                return;
            }
            
            // è®¾ç½®é»˜è®¤ä»·æ ¼ï¼ˆæ ¹æ®åœ°åŸŸååˆ¤æ–­ï¼‰
            let defaultPrice;
            if (regionName === 'hk' || regionName === 'tw' || regionName === 'mo') {
                defaultPrice = 500;
            } else if (regionName === 'sg') {
                defaultPrice = 70;
            } else if (regionName === 'my' || regionName === 'id' || regionName === 'th' || regionName === 'ph' || regionName === 'vn') {
                defaultPrice = 50;
            } else if (regionName === 'jp' || regionName === 'kr') {
                defaultPrice = 800;
            } else {
                defaultPrice = 100;
            }
            
            // åº”ç”¨åˆ°æ‰€æœ‰äº§å“
            let addedCount = 0;
            Object.keys(config).forEach(productName => {
                if (!config[productName][regionName]) {
                    config[productName][regionName] = defaultPrice;
                    addedCount++;
                }
            });
            
            if (addedCount === 0) {
                showMessage('æ‰€æœ‰äº§å“éƒ½å·²åŒ…å«è¯¥åœ°åŸŸï¼Œæœªæ·»åŠ ä»»ä½•åœ°åŸŸ', 'error');
            } else {
                renderProducts();
                saveToServer();
                closeAddRegionModal();
                showMessage(`æˆåŠŸä¸º ${addedCount} ä¸ªäº§å“æ·»åŠ äº†åœ°åŸŸ "${regionName.toUpperCase()}"ï¼`, 'success');
            }
        }

        // ä¿å­˜åˆ°æœåŠ¡å™¨
        function saveToServer() {
            fetch('/api/config', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // showMessage('é…ç½®å·²ä¿å­˜', 'success');
                } else {
                    showMessage('ä¿å­˜å¤±è´¥: ' + data.error, 'error');
                }
            })
            .catch(error => {
                console.error('ä¿å­˜å¤±è´¥:', error);
                showMessage('ä¿å­˜å¤±è´¥', 'error');
            });
        }

        // ä¿å­˜é…ç½®ï¼ˆè§¦å‘ä¿å­˜ï¼‰
        function saveConfig() {
            saveToServer();
            showMessage('é…ç½®å·²ä¿å­˜åˆ° config.json', 'success');
        }

        // å¯¼å‡ºé…ç½®
        function exportConfig() {
            document.getElementById('exportInput').click();
        }

        // å¤„ç†æ–‡ä»¶å¯¼å‡º
        function handleFileExport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    config = JSON.parse(e.target.result);
                    renderProducts();
                    showMessage('é…ç½®å¯¼å…¥æˆåŠŸï¼', 'success');
                } catch (error) {
                    showMessage('é…ç½®æ ¼å¼é”™è¯¯ï¼', 'error');
                }
            };
            reader.readAsText(file);
        }

        // å¯¼å…¥é…ç½®
        function loadConfig() {
            document.getElementById('fileInput').click();
        }

        // å¤„ç†æ–‡ä»¶å¯¼å…¥
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    Object.keys(config).forEach(key => delete config[key]);
                    Object.assign(config, imported);
                    renderProducts();
                    saveToServer();
                    showMessage('é…ç½®å¯¼å…¥æˆåŠŸï¼', 'success');
                } catch (error) {
                    showMessage('é…ç½®æ ¼å¼é”™è¯¯ï¼', 'error');
                }
            };
            reader.readAsText(file);
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 3000);
        }

        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>
