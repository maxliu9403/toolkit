# BrowserID替换功能使用说明

## 功能概述

BrowserID替换功能允许您根据封号数据表，批量替换目标Excel文件中的BrowserID。

## 使用步骤

### 1. 启动服务器

```bash
python app.py
```

服务器将自动在浏览器中打开 `http://localhost:8800`

### 2. 准备数据文件

#### 封号数据表格式要求

封号数据表必须是Excel文件（.xlsx 或 .xls），并包含以下两列：

- **封号ID**: 需要被替换的旧BrowserID
- **新对应ID**: 对应的新BrowserID

**⚠️ 重要限制：仅允许上传1个封号数据表**
- 如需更换，请点击"替换"按钮重新上传
- 或点击"移除"按钮后重新上传

示例：

| 封号ID | 新对应ID |
|--------|----------|
| 520    | 1001     |
| 478    | 1002     |
| 514    | 1003     |

#### 目标Excel文件格式要求

目标Excel文件必须包含 **BrowserID** 列，该列的值将根据封号数据表进行替换。

示例：

| BrowserID | ProductName | Price |
|-----------|-------------|-------|
| BR001     | Product A   | 100   |
| BR002     | Product B   | 200   |
| BR999     | Product C   | 300   |

### 3. 使用Web界面

1. 打开浏览器访问 `http://localhost:8800`
2. 点击 **🔄 BrowserID替换** 标签页
3. **上传封号数据表**
   - 点击第一个上传区域或拖拽文件
   - 选择包含"封号ID"和"新对应ID"列的Excel文件
   - ⚠️ 仅允许上传1个封号数据表
   - 如需更换，可点击文件列表中的"替换"按钮
4. **上传目标Excel文件**
   - 点击第二个上传区域或拖拽文件
   - 可以一次上传多个目标文件
   - 支持批量处理
5. 点击 **🚀 开始替换BrowserID** 按钮
6. 等待处理完成，处理后的文件将自动下载

### 4. 处理结果

- 处理后的文件名格式：`原文件名_replaced.xlsx`
- 日志区域会显示详细的处理信息：
  - 总记录数
  - 替换成功的数量
  - 未匹配的数量

## 替换逻辑

1. 系统读取封号数据表，建立"封号ID"到"新对应ID"的映射关系
2. 遍历目标Excel文件的每一行
3. 如果当前行的BrowserID存在于封号数据表的"封号ID"列中，则替换为对应的"新对应ID"
4. 如果不存在，则保持原值不变
5. 生成新的Excel文件

## 注意事项

1. **必需列**：
   - 封号数据表必须包含"封号ID"和"新对应ID"列
   - 目标Excel文件必须包含"BrowserID"列

2. **文件格式**：
   - 仅支持 .xlsx 和 .xls 格式
   - 确保文件不包含密码保护

3. **数据类型**：
   - 支持整数、浮点数和字符串类型的BrowserID
   - 替换后会保持原始数据类型（整数替换后仍为整数）
   - 确保封号数据表中的ID值唯一

4. **封号数据表限制**：
   - 每次只能上传1个封号数据表
   - 如需更换，点击"替换"按钮重新上传
   - 拖拽多个文件时，仅使用第一个文件

5. **批量处理**：
   - 支持一次上传多个目标Excel文件
   - 所有文件将使用同一个封号数据表进行处理
   - 每个文件处理完成后会自动下载

## 示例

### 输入文件

**封号数据表 (ban_data.xlsx)**
```
封号ID    新对应ID
BR001    NEW001
BR002    NEW002
BR003    NEW003
```

**目标文件 (target.xlsx)**
```
BrowserID  ProductName  Price
BR001      Product A    100
BR002      Product B    200
BR999      Product C    300
BR003      Product D    400
```

### 输出文件 (target_replaced.xlsx)
```
BrowserID  ProductName  Price
NEW001     Product A    100
NEW002     Product B    200
BR999      Product C    300
NEW003     Product D    400
```

注意：BR999 没有在封号数据表中找到，所以保持原值。

## 常见问题

### Q1: 提示"缺少必需的列"怎么办？

**A**: 请检查：
- 封号数据表是否包含"封号ID"和"新对应ID"列（注意中文和大小写）
- 目标Excel文件是否包含"BrowserID"列（注意大小写）

### Q2: 替换后发现有些ID没有变化？

**A**: 这是正常的。只有在封号数据表中存在的BrowserID才会被替换。未在封号数据表中找到的ID会保持原值。

### Q3: 可以一次处理多少个文件？

**A**: 理论上没有限制，但建议每次处理不超过100个文件，以确保浏览器响应流畅。

### Q4: 处理后的文件在哪里？

**A**: 处理完成后，文件会自动下载到浏览器的默认下载目录。

## 技术支持

如有问题，请查看日志输出或联系开发团队。

